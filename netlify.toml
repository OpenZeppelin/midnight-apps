[build]
  base = "apps/lunarswap-ui"
  publish = ".next"
  command = """
  set -euo pipefail
  corepack enable
  corepack prepare pnpm@10.4.1 --activate

  REPO_ROOT="$(git rev-parse --show-toplevel || echo $PWD/../..)"
  COMPACT_HOME="$REPO_ROOT/packages/compact/compactc"
  mkdir -p "$COMPACT_HOME"
  COMPILER_VERSION=0.23.0
  ZIP="compactc_v${COMPILER_VERSION}_x86_64-unknown-linux-musl.zip"
  URL="https://d3fazakqrumx6p.cloudfront.net/artifacts/compiler/compactc_${COMPILER_VERSION}/${ZIP}"
  curl -Ls "$URL" -o "$COMPACT_HOME/compactc.zip"
  unzip -qo "$COMPACT_HOME/compactc.zip" -d "$COMPACT_HOME"
  chmod +x "$COMPACT_HOME"/{compactc,compactc.bin,zkir}
  export COMPACT_HOME PATH="$COMPACT_HOME:$PATH"

  # prebuild to create dist/runCompiler.js & dist/runBuilder.js
  cd "$REPO_ROOT/packages/compact"
  pnpm install
  pnpm run build

  # workspace install & app build
  cd "$REPO_ROOT"
  pnpm install --frozen-lockfile --prefer-offline
  cd apps/lunarswap-ui
  pnpm run build
  """

[build.environment]
  NODE_VERSION = "22"
  PNPM_VERSION = "10.4.1"
  PNPM_ALLOW_SCRIPT = "1"
  PNPM_ENABLE_PREPOST_SCRIPTS = "true"

[[plugins]]
  package = "@netlify/plugin-nextjs"

# (optional) keep your redirects
[[redirects]]
  from = "/lunarswap/*"
  to = "https://lunarswap.netlify.app/:splat"
  status = 200
  force = true
